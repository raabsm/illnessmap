<!DOCTYPE html>
<html>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src = "https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src = "https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src = "https://d3js.org/d3.v4.js"></script>

     <link href = "https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css"
              rel = "stylesheet">
	<style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      .nicebox {
		position: absolute;
		text-align: center;
		font-family: "Roboto", "Arial", sans-serif;
		font-size: 13px;
		z-index: 5;
		box-shadow: 0 4px 6px -4px #333;
		padding: 5px 10px;
		background: rgb(255,255,255);
		background: linear-gradient(to bottom,rgba(255,255,255,1) 0%,rgba(245,245,245,1) 100%);
		border: rgb(229, 229, 229) 1px solid;
	  }
	  .ui-slider-handle {
		color: black;
		font-size: 10px;
		padding: 3px;
		text-shadow: 0 1px 0 #FFFFFF;
		text-decoration:none;
        text-align:center;
		}
      .text-box {
          position: absolute;
          padding: 10px;
          background: rgba(0, 0, 0, 0.91);
          z-index: 900;
          color: #eaf2ff;
      }
      .ui-slider-horizontal {
          height: 8px;
          width: 200px;
          z-index: 999;
      }
      .ui-widget-content {
          background: white;
          margin-bottom: 10px;
      }
      .ui-slider-horizontal .ui-slider-range {
            top: 0;
            background: navajowhite;
            height: 100%;
        }
      .ui-widget-content .ui-state-default {
          background: red;
          width: 3px;
          height: 10px;
      }



  #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
	  #data-box {
        top: 10px;
        left: 500px;
        height: 45px;
        line-height: 45px;
        display: none;
      }	

	  #data-value { font-size: 2.0em; font-weight: bold }
	  #data-label { font-size: 2.0em; font-weight: normal; padding-right: 10px; }
	  #data-label:after { content: ':' }

        #slider-box{
            top: 50px;
            left: 10px;

        }
        #rest-info-box{
            top: 50px;
            width: 500px;
            right: 10px;
            padding: 10px;
            text-align: center;
            display: none;
        }

        #rest-title{
            font-weight: 400;
            margin-bottom: 10px;
            text-align: center;
            font-size: 25px;
            color: navajowhite;
        }
        .rest-info{
            line-height: 28px;
            text-align: left;
        }
        .review-info{
            line-height: 28px;
            display: flex
        }

        .rest-info-title{
            display: inline-block;
            color: white;
        }
        .sentence-score{
            display: inline-block;
            position:absolute;
            color: white;
            float: left;
        }

        .rest-info-value{
            float: right;
            display: inline-block;
            color: #eee;
        }
        .slider-title{
            line-height: 28px;
            text-align: left;
            color: navajowhite;
            font-size: 20px;
            display: inline-flex;
        }
        .review-text{
            position: relative;
            text-align: left;
            max-height: 100px;
            left: 50px;
            overflow: auto;
            float: right;
            padding-right: 50px;
        }
        #histogram{
            position:absolute;
            z-index:2;
            bottom:10px;
        }

    </style>
  </head>
   <div id="data-box" class="nicebox">
      <label id="data-label" for="data-value"></label>
      <span id="data-value"></span>
    </div>

    <div id=slider-box class="text-box">

            <div class="slider-title">Sick Review Slider</div>

            <div id="sick-slider-text" class="rest-info"></div>
            <div id = "sick-review-slider"></div>


            <div class="slider-title">Date Slider</div>
            <form id="select-form" style = "display: inline; float: right; margin-top: 4px">
              <select id="date-select">
                  <option selected="selected" value = "custom">Custom</option>
                  <option value = "week">Last Week</option>
                  <option value = "month">Last Month</option>
                  <option value = "6month">Last 6 Months</option>
                  <option value = "year">Last Year</option>
              </select>
            </form>
            <div id="date-slider-text" class="rest-info"></div>
            <div id = "date-slider"></div>


           <div class="slider-title">Restaurant Threshold Slider</div>
            <div id="rest-slider-text" class="rest-info"></div>
            <div id = "sick-rest-slider"></div>

            <div id = "radio-buttons">
                <form action="">
                    <input type="radio" name="classification" value="reg_total_score">LR
                    <input type="radio" name="classification" value="hsan_total_score">HSAN
                    <input type="radio" name="classification" value="union" checked="checked">Union
                </form>
            </div>
        <button onclick="scaleUp()">Scale Up</button>
        <button onclick="deselectMarker()">Deselect</button>
        <div><button onclick="changeMap()" style="float:right;">Submit</button></div>

	</div>

   <div id="rest-info-box" class="text-box">
       <a href="#" target = "_blank" id="rest-title" style="text-align: center;"></a>
       <div class="rest-info">
           <div class="rest-info-title">Address: </div>
           <div class="rest-info-value" id="address"></div>
       </div>
       <div class="rest-info">
           <div class="rest-info-title">Rating: </div>
           <div class="rest-info-value" id="rating"></div>
       </div>
        <div class="rest-info">
           <div class="rest-info-title">Sick Review Count (within Slider bounds): </div>
           <div class="rest-info-value" id="sick_score"></div>
       </div>
       <div class="rest-info">
           <div class="rest-info-title">Total Reviews: </div>
           <div class="rest-info-value" id="total-reviews"></div>
       </div>
<!--       <button onclick="displaySickReviews(selectedMarker.reviews, compareDates, 'reviews')">Sort By Date</button>-->
<!--       <button onclick="displaySickReviews(selectedMarker.reviews, compareLRScores, 'reviews')">Sort By LR Score</button>-->
<!--       <button onclick="displaySickReviews(selectedMarker.reviews, compareHSANScores, 'reviews')">Sort By HSAN Score</button>-->
       <div class="rest-info">
         <form style = "margin-top: 4px">
              <select id="sort-by-select">
                  <option selected="selected" value = "date">Sort By Date</option>
                  <option value = "hsan">Sort By HSAN</option>
                  <option value = "lr">Sort By LR</option>
              </select>
         </form>
       </div>
       <div id="reviews"></div>
       <button onclick="openBusinessWindow()" style="float:right;">More Info</button>
   </div>

  <div id="histogram"></div>

    <div id="map"></div>
    <script>
      var map;
      var sickMin = Number.MAX_VALUE, sickMax = -Number.MAX_VALUE;
      var sickReviewBottomThreshold = 0.5;
      var sickReviewTopThreshold = 1.0;
      var sickRestaurantThreshold = 5;
      var scalingFactor = 3;
      var selectedMarker = null;
      var xhr = null;
      var classification = 'union';
      var allReviewsForSelectedMarker = null;

      var zipFeature = {'feature': null, 'over': false};
      var markers = [];

      var startTime = (new Date(2018, 1, 1)).getTime();
      var endTime = (new Date()).getTime();

      var margin = {top: 10, right: 30, bottom: 30, left: 40},
                    width = 450 - margin.left - margin.right,
                    height = 100 - margin.top - margin.bottom;

        // append the svg object to the body of the page
      var svg = d3.select("#histogram")
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");
      var reviewsForHist = [];
      var y = d3.scaleLinear().range([height, 0]);
      var yAxis = svg.append("g");

      var x = d3.scaleTime().domain([new Date(startTime), new Date(endTime)]).range([0, width]);
      var xAxis = svg.append("g").attr("transform", "translate(0," + height + ")");



      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 11,
          center: new google.maps.LatLng(40.75,-74.00),
          mapTypeId: 'roadmap'
        });
        loadGeoJson();
        // google.maps.event.addDomListener(document.getElementById('map'), 'dblclick', function() {
        //     document.getElementById('rest-info-box').style.display = 'none';
        //     if(selectedMarker != null){
        //         makeNeutralIcon(selectedMarker, 5);
        //         selectedMarker = null;
        //     }
        // });

        map.data.setStyle(styleFeature);
        map.data.addListener('mouseover', mouseInToRegion);
        map.data.addListener('mouseout', mouseOutOfRegion);

    }

    function deselectMarker(){
          document.getElementById('rest-info-box').style.display = 'none';
            if(selectedMarker != null){
                makeNeutralIcon(selectedMarker);
                selectedMarker = null;
            }
    }

    function openBusinessWindow(){
        let params = {
            business_id: selectedMarker.rest_info.id,
            start_time: startTime,
            end_time: endTime,
            review_bottom_threshold: sickReviewBottomThreshold,
            review_top_threshold: sickReviewTopThreshold
        };
        OpenWindowWithPost("/restaurant_info", params);
    }

    function OpenWindowWithPost(url, params)
   {
            var form = document.createElement("form");
            form.setAttribute("method", "post");
            form.setAttribute("action", url);
            form.setAttribute("target", '_blank');

            for (var i in params) {
                if (params.hasOwnProperty(i)) {
                    var input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = i;
                    input.value = params[i];
                    form.appendChild(input);
                    console.log(input)
                }
            }

            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
    }

    function changeMap(){
          reviewsForHist = [];
        classification = document.querySelector('input[name="classification"]:checked').value;
        if(xhr)
            xhr.abort();

        console.log(getFormattedDate(new Date(startTime)), getFormattedDate(new Date(endTime)), classification);
        for(var i = 0; i<markers.length; i++){
            if(markers[i] !== selectedMarker)
                markers[i].setMap(null);
        }
        markers = [];
        if(selectedMarker != null){
            markers.push(selectedMarker);
        }
        loadRestaurants();
    }

    $(function (){
        $("#sick-review-slider").slider({
            range: true,
            min: 0.1,
            max: 1.0,
            step: 0.1,
            values: [sickReviewBottomThreshold, sickReviewTopThreshold],
            slide: function(event, ui){
                 $("#sick-slider-text").text( ui.values[0] + " - " + ui.values[1]);
            },
            stop: function(event, ui){
                sickReviewBottomThreshold = ui.values[0];
                sickReviewTopThreshold = ui.values[1];
            }
		})

        let sliderStartTime = new Date(2005, 8, 2).getTime();

        $("#date-slider").slider({
            range: true,
            min: sliderStartTime / 1000,
            max: endTime / 1000,
            step: 604800,
            values: [startTime / 1000, endTime / 1000],
            slide: function( event, ui ) {
                 $( "#date-slider-text" ).text( getFormattedDate(new Date(ui.values[ 0 ] *1000)) + " - " + getFormattedDate(new Date(ui.values[ 1 ] *1000)));
             },
            change: function(event, ui){
                $( "#date-slider-text" ).text( getFormattedDate(new Date(ui.values[0] *1000)) + " - " + getFormattedDate(new Date(ui.values[1] *1000)));
                startTime = ui.values[0] * 1000;
                endTime = ui.values[1] * 1000;
            }
		})

         $("#sick-rest-slider").slider({
            min: 1,
            max: 10,
            step: 1,
            value: sickRestaurantThreshold,
            slide: function( event, ui ) {
                 $( "#rest-slider-text" ).text(ui.value);
             },
            stop: function(event, ui){
                sickRestaurantThreshold = ui.value;
            }
		})

        $("#sick-slider-text").text(sickReviewBottomThreshold + " - " + sickReviewTopThreshold);
        $("#date-slider-text").text(getFormattedDate(new Date(startTime)) + " - " + getFormattedDate(new Date(endTime)));
        $("#rest-slider-text").text(sickRestaurantThreshold);

        $("#date-select").on("change", function() {
            var today = new Date();
            let option = this.value;
            var date = new Date();
            $("#date-slider").slider("disable");
            if (option == 'week'){
                date.setDate(today.getDate() - 7);
            }
            else if(option == 'month'){
                date.setMonth(today.getMonth() - 1);
            }
            else if(option == '6month'){
                date.setMonth(today.getMonth() - 6);
            }
            else if(option == 'year'){
                date.setFullYear(today.getFullYear() - 1);
            }
            else{
                $("#date-slider").slider("enable");
                date = new Date(startTime);
            }
            $("#date-slider").slider("values", [date.getTime()/1000, today.getTime()/1000]);
        })

        $("#sort-by-select").on("change", function() {
            let option = this.value;

            if(option == 'date'){
                displaySickReviews(selectedMarker.reviews, compareDates, 'reviews');
            }
            else if(option == 'hsan'){
                displaySickReviews(selectedMarker.reviews, compareHSANScores, 'reviews');
            }
            else{
                displaySickReviews(selectedMarker.reviews, compareLRScores, 'reviews');
            }
        })
    })

      function getFormattedDate(date) {
          var year = date.getFullYear();

          var month = (1 + date.getMonth()).toString();
          month = month.length > 1 ? month : '0' + month;

          var day = date.getDate().toString();
          day = day.length > 1 ? day : '0' + day;

          return month + '/' + day + '/' + year;
      }

    function loadRestaurants(){
        xhr = $.getJSON("/static/march_zipcode_sick_reviews.json", function(zip_codes){
            sickMin = Number.MAX_VALUE;
            sickMax = -Number.MAX_VALUE;
            for(var zip in zip_codes){
                let reviewDatesPerZip = [];
                businesses = zip_codes[zip];
                var zip_sick_count = 0;
                businesses.forEach(function (business){    
                   let latlng = new google.maps.LatLng(business['lat-long'][0],
                           business['lat-long'][1]);

                   let reviews = [];

                   let aboveThreshold = 0;
                   for(var i = 0; i<business['reviews'].length; i++) {
                       let reviewScore = 0;
                       if(classification == 'union'){
                           reviewScore = Math.max(business['reviews'][i]['reg_total_score'], business['reviews'][i]['hsan_total_score']);
                       }
                       else{
                           reviewScore = business['reviews'][i][classification];
                       }
                       var reviewTime = Date.parse(business['reviews'][i]['date_created']);

                       if (reviewScore < sickReviewBottomThreshold ||
                           reviewScore > sickReviewTopThreshold ||
                           reviewTime < startTime ||
                           reviewTime > endTime) {

                           continue;
                       } else {
                           reviews.push(business['reviews'][i]);
                           reviewsForHist.push(new Date(reviewTime));
                           reviewDatesPerZip.push(new Date(reviewTime));
                           aboveThreshold += 1;
                       }
                   }
                   zip_sick_count += aboveThreshold;

                   if(selectedMarker != null && selectedMarker.rest_info.id == business['business_id']){
                       console.log("ran if statement on", selectedMarker.rest_info.name);
                       selectedMarker.normal_icon.scale = aboveThreshold/scalingFactor;
                       selectedMarker.reviews = reviews;
                       selectedMarker.rest_info.total_review_count = business['review_count'];
                       selectedMarker.rest_info.rating = business['rating'];
                       selectedMarker.sick_score = aboveThreshold;
                       updateClickBox(selectedMarker, compareDates);
                       return;
                   }

                   if(aboveThreshold < sickRestaurantThreshold){
                     return;
                   }

                   var regular_icon = {
                           path: google.maps.SymbolPath.CIRCLE,
                           scale: aboveThreshold/scalingFactor,
                           fillColor: 'blue',
                           fillOpacity: 0.3,
                           strokeWeight: 1,
                           strokeColor:'grey'
                       };

                   var marker = new google.maps.Marker({
                       map: map,
                       normal_icon: regular_icon,
                       icon: regular_icon,
                       position: latlng,
                       sick_score: aboveThreshold,
                       reviews: reviews,
                       rest_info:{
                           name: business['name'],
                           id: business['business_id'],
                           address: business['address'],
                           total_review_count: business['review_count'],
                           url: business['url'],
                           rating: business['rating'],
                       },
                       zIndex: 999
                   })

                   google.maps.event.addListener(marker, 'mouseover', function() {
                        updateMouseoverBox(this.rest_info.name, this.sick_score);

                        var icon = this.icon;
                        icon.scale = this.normal_icon.scale + 3;
                        this.setIcon(icon);
                    });

                    google.maps.event.addListener(marker, 'click', function() {
                        updateClickBox(this, compareDates);
                        if(selectedMarker != null){
                            makeNeutralIcon(selectedMarker);
                        }
                        selectedMarker = this;
                        this.setIcon('https://www.google.com/mapfiles/marker_green.png');
                    });

                   google.maps.event.addListener(marker, 'mouseout', function() {
                       if(zipFeature['over']){
                           var feature = zipFeature['feature'];
                           var sickScoreString = feature.getProperty('sick_score');
                           updateMouseoverBox(feature.getProperty('postalcode'), sickScoreString);
                       }

                       if(selectedMarker!== this){
                           makeNeutralIcon(this);
                       }
                   });  
                   markers.push(marker);
                })

                if(zip_sick_count > sickMax){
                    sickMax = zip_sick_count;
                }
                if(zip_sick_count < sickMin){
                    sickMin = zip_sick_count;
                }
                var feature = map.data.getFeatureById(zip);
                if(feature === undefined){
                   // console.log("undefined");
                }
                else{
                    feature.setProperty('sick_score', zip_sick_count);
                    feature.setProperty('review_dates', reviewDatesPerZip);
                }
            }
            xhr = null;
            changeHistogram(reviewsForHist);
    	}).fail(function (jqxhr, status, error) {
                console.log('error', status, error) }
            );
	}

	function makeNeutralIcon(marker){
        marker.setIcon(marker.normal_icon);
    }
    function loadGeoJson() {
        map.data.loadGeoJson('/static/nyc_zip_code.geojson', {idPropertyName :'postalcode'});
        google.maps.event.addListenerOnce(map.data, 'addfeature', function() {
    //        loadSickData();
            loadRestaurants();
        });
    }

    function scaleUp(){
          for(var i =0; i < markers.length; i++){
              var icon = markers[i].normal_icon;
              icon.scale += 2;
              markers[i].normal_icon = icon;
              if(markers[i] !== selectedMarker)
                  markers[i].setIcon(icon);
          }
    }

    function updateClickBox(marker, sortFunction){
          var restInfo = marker.rest_info;
          var sickScore = marker.sick_score;
          var box = document.getElementById('rest-info-box');
          box.style.display = 'block';
          document.getElementById('rest-title').href = restInfo.url;
          document.getElementById('rest-title').textContent = restInfo.name;
          document.getElementById('address').textContent = restInfo.address;
          document.getElementById('rating').textContent = restInfo.rating;
          document.getElementById('total-reviews').textContent = restInfo.total_review_count;
          document.getElementById('sick_score').textContent = sickScore;

          displaySickReviews(marker.reviews, compareDates, 'reviews');
    }

    function displaySickReviews(reviews, sortFunction, reviewsDiv){
        reviews.sort(sortFunction);
        var reviewHtml = document.getElementById(reviewsDiv);
        reviewHtml.innerHTML = "";
        for(var i = 0; i < reviews.length; i++){
            var hsan = reviews[i]['classification_hsan'];
            if(!("sentence_scores" in hsan) || hsan['sentence_scores'].length != reviews[i]['sentences'].length){
                continue;
            }
            else{
                 console.log(reviews[i]['review_id']);
                 let reviewDiv = document.createElement('div');
                 let url = reviews[i]['review_url'];
                 let date = getFormattedDate(new Date(reviews[i]['date_created']));
                 let regSickScore = reviews[i]['reg_total_score'].toFixed(2);
                 let hsanSickScore = reviews[i]['hsan_total_score'];
                 if (hsanSickScore == 0){
                     hsanSickScore = 'N/A'
                 }
                 else{
                     hsanSickScore = hsanSickScore.toFixed(2);
                 }
                 let revTitle = document.createElement('a');
                 revTitle.className = 'rest_info_title';
                 revTitle.setAttribute("style", "color:navajowhite; display:flex;");
                 let linkText = document.createTextNode(date + ' LR: ' + regSickScore + ' HSAN: ' + hsanSickScore);
                 revTitle.href = url;
                 revTitle.setAttribute('target', '_blank');
                 revTitle.appendChild(linkText);

                 reviewDiv.appendChild(revTitle);

                 let sentenceIndicesToDisplay;

                 if(hsan['sick_sentences'].length > 0){
                     sentenceIndicesToDisplay = indicesOfSickSentences(hsan['sick_sentences'], reviews[i]['sentences']);
                 }
                 else{
                     sentenceIndicesToDisplay = topSickSentences(hsan['sentence_scores']);
                 }

                 for(let j = 0; j < sentenceIndicesToDisplay.length; j++){
                     let index = sentenceIndicesToDisplay[j];
                     let sentenceInfo = document.createElement('div');
                     sentenceInfo.className = 'review-info';

                     let sentenceScore = document.createElement('div');
                     sentenceScore.className = "sentence-score";
                     sentenceScore.textContent = hsan['sentence_scores'][index].toFixed(2);

                     let revText = document.createElement('div');
                     revText.className = 'review-text';
                     revText.textContent = reviews[i]['sentences'][index];

                     sentenceInfo.appendChild(sentenceScore);
                     sentenceInfo.appendChild(revText);
                     reviewDiv.appendChild(sentenceInfo);
                 }
                reviewHtml.appendChild(reviewDiv);
            }
        }


    }

    function indicesOfSickSentences(sickSentences, reviewSentences){
        let indices = [];
          for(let i = 0; i< reviewSentences.length; i++){
              for(let j = 0; j < sickSentences.length; j++){
                  if (reviewSentences[i].includes(sickSentences[j]))
                      indices.push(i);
              }
          }
        return indices;
    }

    function topSickSentences(sentencesScores){
        let maxIndex = 0;
        let maxScore = sentencesScores[0];
        for(let i = 0; i< sentencesScores.length; i++){
            if (sentencesScores[i] > maxScore){
                maxScore = sentencesScores[i];
                maxIndex = i;
            }
        }
        return [maxIndex];
    }

    function compareDates(a, b){
        var aDate = a['date_created'];
        var bDate = b['date_created'];

        return aDate < bDate ? 1 : -1;
    }

    function compareLRScores(a, b){
        let compare = 'reg_total_score';

        var aScore = a[compare];
        var bScore = b[compare];

        return aScore < bScore ? 1 : -1
    }


    function compareHSANScores(a, b){
        let compare = 'hsan_total_score';

        var aScore = a[compare];
        var bScore = b[compare];

        return aScore < bScore ? 1 : -1
    }

    function changeHistogram(values){
        x = d3.scaleTime().domain([new Date(startTime), new Date(endTime)]).range([0, width]);

         var histogram = d3.histogram()
            .value(function(d) { return d; })   // I need to give the vector of value
             .domain(x.domain())  // then the domain of the graphic
            .thresholds(x.ticks(20)); // then the numbers of bins

        var bins = histogram(values);

        y.domain([0, d3.max(bins, function(d) { return d.length; })]);   // d3.hist has to be called before the Y axis obviously
        yAxis.transition()
        .duration(1000)
        .call(d3.axisLeft(y).ticks(4));

        xAxis.transition().duration(1000).call(d3.axisBottom(x).ticks(4))

        var u = svg.selectAll("rect")
                .data(bins);

    // Manage the existing bars and eventually the new ones:
        u
        .enter()
        .append("rect") // Add a new rect for each new elements
        .merge(u) // get the already existing elements as well
        .transition() // and apply changes to all of them
        .duration(1000)
          .attr("x", 1)
          .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
          .attr("width", function(d) { return Math.max(x(d.x1) - x(d.x0) -1, 0); })
          .attr("height", function(d) { return height - y(d.length); })
          .style("fill", "blue")


    // If less bar in the new histogram, I delete the ones not in use anymore
         u.exit().remove()
    }

    function styleFeature(feature) {
        var normalizedFillOpacity = (feature.getProperty('sick_score') - sickMin) /
            (sickMax-sickMin);
       // normalizedFillOpacity = 1 - normalizedFillOpacity;
        
        var outlineWeight = 0.5, zIndex = 1;
            if (feature.getProperty('state') === 'hover') {
                outlineWeight = zIndex = 2;
            }

        return {
            strokeWeight: outlineWeight,
            strokeColor: '#fff',
            fillColor: 'red',
            fillOpacity: normalizedFillOpacity,
            zIndex: zIndex
        }
    
    }

    function updateMouseoverBox(dataLabel, dataValue) {
          document.getElementById('data-label').textContent = dataLabel;
          document.getElementById('data-value').textContent = dataValue;
          document.getElementById('data-box').style.display = 'block';
    }
        
    function mouseInToRegion(event) {
		event.feature.setProperty('state', 'hover');
        zipFeature['feature'] = event.feature;
        zipFeature['over'] = true;
		
		var sickScoreString = event.feature.getProperty('sick_score');
		updateMouseoverBox(event.feature.getProperty('postalcode'), sickScoreString);
		if(event.feature.getProperty('review_dates')) {
            changeHistogram(event.feature.getProperty('review_dates'));
        }
	}

    function mouseOutOfRegion(event) {
        event.feature.setProperty('state', 'normal');
        zipFeature['over'] = false;
        changeHistogram(reviewsForHist);
    }
    
    </script>
    <script async defer
         src="https://maps.googleapis.com/maps/api/js?key={{ API_KEY }}&callback=initMap">
    </script>
  </body>
</html>

